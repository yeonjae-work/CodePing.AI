name: ğŸ“š Documentation Automation

on:
  push:
    branches: [ main, develop ]
    paths:
      - '**/*.py'
      - '**/*.md'
      - 'requirements.txt'
      - 'pyproject.toml'
      - 'docs/**'
  pull_request:
    branches: [ main ]
    paths:
      - '**/*.py'
      - '**/*.md'
      - 'requirements.txt'
      - 'docs/**'
  schedule:
    # ë§¤ì£¼ ì¼ìš”ì¼ ì˜¤ì „ 3ì‹œ (UTC)ì— ì „ì²´ ë¬¸ì„œ ì¬ìƒì„±
    - cron: '0 3 * * 0'
  workflow_dispatch:
    inputs:
      doc_type:
        description: 'Documentation type to generate'
        required: true
        default: 'all'
        type: choice
        options:
        - all
        - api
        - architecture
        - changelog
        - coverage

env:
  PYTHON_VERSION: "3.12"

jobs:
  # ğŸ“Š ì½”ë“œ ë¶„ì„ ë° ë©”íŠ¸ë¦­ ìˆ˜ì§‘
  code-analysis:
    name: ğŸ“Š Code Analysis & Metrics
    runs-on: ubuntu-latest
    
    outputs:
      has_code_changes: ${{ steps.changes.outputs.has_code_changes }}
      has_doc_changes: ${{ steps.changes.outputs.has_doc_changes }}
      
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
        
    - name: ğŸ” Detect changes
      id: changes
      run: |
        if git diff --name-only HEAD~1 HEAD | grep -E '\.(py|pyi)$' > /dev/null; then
          echo "has_code_changes=true" >> $GITHUB_OUTPUT
        else
          echo "has_code_changes=false" >> $GITHUB_OUTPUT
        fi
        
        if git diff --name-only HEAD~1 HEAD | grep -E '\.(md|rst|txt)$' > /dev/null; then
          echo "has_doc_changes=true" >> $GITHUB_OUTPUT
        else
          echo "has_doc_changes=false" >> $GITHUB_OUTPUT
        fi
        
    - name: ğŸ Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: ${{ env.PYTHON_VERSION }}
        
    - name: ğŸ”§ Install analysis tools
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install pdoc3 sphinx sphinx-rtd-theme pydocstyle radon vulture
        pip install coverage pytest-cov interrogate
        
    - name: ğŸ“Š Generate code metrics
      run: |
        mkdir -p docs/metrics
        
        # ì½”ë“œ ë³µì¡ë„ ë¶„ì„
        echo "# ğŸ“Š Code Complexity Analysis" > docs/metrics/complexity.md
        echo "" >> docs/metrics/complexity.md
        echo "Generated on: $(date)" >> docs/metrics/complexity.md
        echo "" >> docs/metrics/complexity.md
        
        radon cc . --show-complexity --total-average --json > docs/metrics/complexity.json
        radon mi . --json > docs/metrics/maintainability.json
        radon raw . --json > docs/metrics/raw_metrics.json
        
        # ë³µì¡ë„ ìš”ì•½ì„ ë§ˆí¬ë‹¤ìš´ìœ¼ë¡œ ë³€í™˜
        python -c "
        import json
        
        with open('docs/metrics/complexity.json') as f:
            data = json.load(f)
            
        print('## ğŸ” Cyclomatic Complexity')
        print('| File | Function | Complexity | Grade |')
        print('|------|----------|------------|-------|')
        
        for file_path, functions in data.items():
            if isinstance(functions, list):
                for func in functions:
                    if isinstance(func, dict) and 'complexity' in func:
                        grade = 'A' if func['complexity'] <= 5 else 'B' if func['complexity'] <= 10 else 'C' if func['complexity'] <= 20 else 'D'
                        print(f'| {file_path} | {func.get(\"name\", \"N/A\")} | {func[\"complexity\"]} | {grade} |')
        " >> docs/metrics/complexity.md
        
    - name: ğŸ“ˆ Generate test coverage report
      run: |
        mkdir -p docs/coverage
        
        # í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ ì‹¤í–‰
        python -m pytest tests/ --cov=. --cov-report=html --cov-report=json --cov-report=term
        
        # ì»¤ë²„ë¦¬ì§€ ë°ì´í„°ë¥¼ docsë¡œ ì´ë™
        if [ -d "htmlcov" ]; then
          mv htmlcov docs/coverage/
        fi
        
        if [ -f "coverage.json" ]; then
          mv coverage.json docs/coverage/
        fi
        
        # ì»¤ë²„ë¦¬ì§€ ìš”ì•½ ìƒì„±
        echo "# ğŸ“Š Test Coverage Report" > docs/coverage/README.md
        echo "" >> docs/coverage/README.md
        echo "Generated on: $(date)" >> docs/coverage/README.md
        echo "" >> docs/coverage/README.md
        
        if [ -f "docs/coverage/coverage.json" ]; then
          python -c "
          import json
          
          with open('docs/coverage/coverage.json') as f:
              data = json.load(f)
              
          total = data['totals']
          print(f'## ğŸ“ˆ Overall Coverage: {total[\"percent_covered\"]:.1f}%')
          print('')
          print(f'- **Lines Covered**: {total[\"covered_lines\"]} / {total[\"num_statements\"]}')
          print(f'- **Missing Lines**: {total[\"missing_lines\"]}')
          print('')
          print('## ğŸ“ File Coverage')
          print('| File | Coverage | Lines | Missing |')
          print('|------|----------|-------|---------|')
          
          for file_path, file_data in data['files'].items():
              coverage = file_data['summary']['percent_covered']
              covered = file_data['summary']['covered_lines']
              total_lines = file_data['summary']['num_statements']
              missing = file_data['summary']['missing_lines']
              print(f'| {file_path} | {coverage:.1f}% | {covered}/{total_lines} | {missing} |')
          " >> docs/coverage/README.md
        fi
        
    - name: ğŸ“ Documentation quality check
      run: |
        mkdir -p docs/quality
        
        # Docstring ì»¤ë²„ë¦¬ì§€ ì²´í¬
        interrogate . --generate-badge docs/quality/docstring-coverage.svg
        interrogate . --verbose > docs/quality/docstring-report.txt
        
        # ë¬¸ì„œ í’ˆì§ˆ ë¦¬í¬íŠ¸ ìƒì„±
        echo "# ğŸ“ Documentation Quality Report" > docs/quality/README.md
        echo "" >> docs/quality/README.md
        echo "Generated on: $(date)" >> docs/quality/README.md
        echo "" >> docs/quality/README.md
        echo "![Docstring Coverage](docstring-coverage.svg)" >> docs/quality/README.md
        echo "" >> docs/quality/README.md
        echo "## ğŸ“Š Detailed Report" >> docs/quality/README.md
        echo '```' >> docs/quality/README.md
        cat docs/quality/docstring-report.txt >> docs/quality/README.md
        echo '```' >> docs/quality/README.md
        
    - name: ğŸ“Š Upload analysis artifacts
      uses: actions/upload-artifact@v3
      with:
        name: code-analysis-reports
        path: |
          docs/metrics/
          docs/coverage/
          docs/quality/

  # ğŸ”§ API ë¬¸ì„œ ìë™ ìƒì„±
  api-documentation:
    name: ğŸ”§ API Documentation Generation
    runs-on: ubuntu-latest
    needs: code-analysis
    if: needs.code-analysis.outputs.has_code_changes == 'true' || github.event.inputs.doc_type == 'all' || github.event.inputs.doc_type == 'api'
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
      
    - name: ğŸ Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: ${{ env.PYTHON_VERSION }}
        
    - name: ğŸ”§ Install documentation tools
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install pdoc3 sphinx sphinx-rtd-theme sphinx-autodoc-typehints
        pip install myst-parser sphinx-copybutton sphinx-tabs
        
    - name: ğŸ“– Generate API documentation with pdoc
      run: |
        mkdir -p docs/api
        
        # PyPI íŒ¨í‚¤ì§€ë“¤ì— ëŒ€í•œ API ë¬¸ì„œ ìƒì„±
        echo "# ğŸ”§ CodePing.AI API Documentation" > docs/api/README.md
        echo "" >> docs/api/README.md
        echo "Generated on: $(date)" >> docs/api/README.md
        echo "" >> docs/api/README.md
        echo "## ğŸ“¦ Universal Packages API" >> docs/api/README.md
        echo "" >> docs/api/README.md
        
        # ê° ëª¨ë“ˆë³„ API ë¬¸ì„œ ìƒì„±
        modules=(
          "universal_data_storage"
          "universal_webhook_receiver"
          "universal_git_data_parser"
          "universal_llm_service"
          "universal_notification_service"
          "universal_notion_sync"
          "universal_schedule_manager"
          "universal_http_api_client"
          "universal_prompt_builder"
          "universal_data_aggregator"
          "universal_data_retriever"
          "universal_diff_analyzer"
        )
        
        for module in "${modules[@]}"; do
          echo "Generating API docs for $module..."
          if python -c "import $module" 2>/dev/null; then
            pdoc3 --html --output-dir docs/api --force $module
            echo "- [$module](${module}/index.html)" >> docs/api/README.md
          else
            echo "âš ï¸ Module $module not available, skipping..."
            echo "- âš ï¸ $module (not available)" >> docs/api/README.md
          fi
        done
        
        # ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ëª¨ë“ˆë“¤
        if [ -d "shared" ]; then
          pdoc3 --html --output-dir docs/api --force shared
          echo "- [shared](shared/index.html)" >> docs/api/README.md
        fi
        
        if [ -d "infrastructure" ]; then
          pdoc3 --html --output-dir docs/api --force infrastructure
          echo "- [infrastructure](infrastructure/index.html)" >> docs/api/README.md
        fi
        
    - name: ğŸ“š Generate Sphinx documentation
      run: |
        mkdir -p docs/sphinx
        
        # Sphinx ì„¤ì • íŒŒì¼ ìƒì„±
        cat > docs/sphinx/conf.py << 'EOF'
        import os
        import sys
        sys.path.insert(0, os.path.abspath('../..'))

        project = 'CodePing.AI'
        copyright = '2024, CodePing.AI Team'
        author = 'CodePing.AI Team'
        release = '1.0.0'

        extensions = [
            'sphinx.ext.autodoc',
            'sphinx.ext.viewcode',
            'sphinx.ext.napoleon',
            'sphinx.ext.intersphinx',
            'sphinx_autodoc_typehints',
            'myst_parser',
            'sphinx_copybutton',
            'sphinx_tabs.tabs',
        ]

        templates_path = ['_templates']
        exclude_patterns = ['_build', 'Thumbs.db', '.DS_Store']

        html_theme = 'sphinx_rtd_theme'
        html_static_path = ['_static']

        autodoc_default_options = {
            'members': True,
            'member-order': 'bysource',
            'special-members': '__init__',
            'undoc-members': True,
            'exclude-members': '__weakref__'
        }

        napoleon_google_docstring = True
        napoleon_numpy_docstring = True
        napoleon_include_init_with_doc = False
        napoleon_include_private_with_doc = False
        napoleon_include_special_with_doc = True
        napoleon_use_admonition_for_examples = False
        napoleon_use_admonition_for_notes = False
        napoleon_use_admonition_for_references = False
        napoleon_use_ivar = False
        napoleon_use_param = True
        napoleon_use_rtype = True
        napoleon_preprocess_types = False
        napoleon_type_aliases = None
        napoleon_attr_annotations = True

        source_suffix = {
            '.rst': None,
            '.md': 'myst_parser.sphinx_',
        }
        EOF
        
        # ë©”ì¸ index.rst ìƒì„±
        cat > docs/sphinx/index.rst << 'EOF'
        CodePing.AI Documentation
        =========================

        Welcome to CodePing.AI's documentation!

        .. toctree::
           :maxdepth: 2
           :caption: Contents:

           modules
           api_reference
           architecture
           deployment

        Indices and tables
        ==================

        * :ref:`genindex`
        * :ref:`modindex`
        * :ref:`search`
        EOF
        
        # ëª¨ë“ˆ ë¬¸ì„œ ìë™ ìƒì„±
        sphinx-apidoc -o docs/sphinx . --separate -f
        
        # Sphinx ë¹Œë“œ
        cd docs/sphinx
        make html || echo "Sphinx build completed with warnings"
        
    - name: ğŸ“Š Upload API documentation
      uses: actions/upload-artifact@v3
      with:
        name: api-documentation
        path: |
          docs/api/
          docs/sphinx/

  # ğŸ—ï¸ ì•„í‚¤í…ì²˜ ë¬¸ì„œ ìë™ ìƒì„±
  architecture-documentation:
    name: ğŸ—ï¸ Architecture Documentation
    runs-on: ubuntu-latest
    needs: code-analysis
    if: needs.code-analysis.outputs.has_code_changes == 'true' || github.event.inputs.doc_type == 'all' || github.event.inputs.doc_type == 'architecture'
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
      
    - name: ğŸ Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: ${{ env.PYTHON_VERSION }}
        
    - name: ğŸ”§ Install analysis tools
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install pydeps graphviz pyreverse pylint
        
    - name: ğŸ—ï¸ Generate architecture diagrams
      run: |
        mkdir -p docs/architecture
        
        echo "# ğŸ—ï¸ CodePing.AI Architecture Documentation" > docs/architecture/README.md
        echo "" >> docs/architecture/README.md
        echo "Generated on: $(date)" >> docs/architecture/README.md
        echo "" >> docs/architecture/README.md
        
        # ëª¨ë“ˆ ì˜ì¡´ì„± ë‹¤ì´ì–´ê·¸ë¨ ìƒì„±
        echo "## ğŸ“¦ Module Dependencies" >> docs/architecture/README.md
        echo "" >> docs/architecture/README.md
        
        # PyPI íŒ¨í‚¤ì§€ ì˜ì¡´ì„± ë¶„ì„
        python -c "
        import subprocess
        import json
        
        packages = [
            'universal_data_storage',
            'universal_webhook_receiver', 
            'universal_git_data_parser',
            'universal_llm_service',
            'universal_notification_service',
            'universal_notion_sync',
            'universal_schedule_manager',
            'universal_http_api_client',
            'universal_prompt_builder',
            'universal_data_aggregator',
            'universal_data_retriever',
            'universal_diff_analyzer'
        ]
        
        print('```mermaid')
        print('graph TD')
        
        # íŒ¨í‚¤ì§€ ë…¸ë“œ ìƒì„±
        for i, pkg in enumerate(packages):
            clean_name = pkg.replace('universal_', '').replace('_', ' ').title()
            print(f'    {pkg.upper()}[\"{clean_name}\"]')
            
        # ì£¼ìš” ì˜ì¡´ì„± ê´€ê³„ ì •ì˜
        dependencies = [
            ('UNIVERSAL_WEBHOOK_RECEIVER', 'UNIVERSAL_DATA_STORAGE'),
            ('UNIVERSAL_GIT_DATA_PARSER', 'UNIVERSAL_DATA_STORAGE'),
            ('UNIVERSAL_LLM_SERVICE', 'UNIVERSAL_PROMPT_BUILDER'),
            ('UNIVERSAL_NOTIFICATION_SERVICE', 'UNIVERSAL_DATA_RETRIEVER'),
            ('UNIVERSAL_SCHEDULE_MANAGER', 'UNIVERSAL_DATA_STORAGE'),
            ('UNIVERSAL_DATA_AGGREGATOR', 'UNIVERSAL_DATA_RETRIEVER'),
            ('UNIVERSAL_DIFF_ANALYZER', 'UNIVERSAL_GIT_DATA_PARSER'),
        ]
        
        for src, dst in dependencies:
            print(f'    {src} --> {dst}')
            
        print('```')
        " >> docs/architecture/README.md
        
        # ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨
        echo "" >> docs/architecture/README.md
        echo "## ğŸ”„ System Architecture" >> docs/architecture/README.md
        echo "" >> docs/architecture/README.md
        echo '```mermaid' >> docs/architecture/README.md
        echo 'graph TB' >> docs/architecture/README.md
        echo '    subgraph "External Services"' >> docs/architecture/README.md
        echo '        GitHub["ğŸ”— GitHub"]' >> docs/architecture/README.md
        echo '        Slack["ğŸ“± Slack"]' >> docs/architecture/README.md
        echo '        OpenAI["ğŸ¤– OpenAI"]' >> docs/architecture/README.md
        echo '        Notion["ğŸ“ Notion"]' >> docs/architecture/README.md
        echo '    end' >> docs/architecture/README.md
        echo '' >> docs/architecture/README.md
        echo '    subgraph "CodePing.AI Core"' >> docs/architecture/README.md
        echo '        WH["ğŸ”— Webhook Receiver"]' >> docs/architecture/README.md
        echo '        GP["ğŸ” Git Parser"]' >> docs/architecture/README.md
        echo '        DS["ğŸ“Š Data Storage"]' >> docs/architecture/README.md
        echo '        LLM["ğŸ¤– LLM Service"]' >> docs/architecture/README.md
        echo '        NS["ğŸ“± Notification"]' >> docs/architecture/README.md
        echo '    end' >> docs/architecture/README.md
        echo '' >> docs/architecture/README.md
        echo '    subgraph "Infrastructure"' >> docs/architecture/README.md
        echo '        DB["ğŸ—„ï¸ PostgreSQL"]' >> docs/architecture/README.md
        echo '        S3["â˜ï¸ AWS S3"]' >> docs/architecture/README.md
        echo '        Redis["ğŸ”„ Redis"]' >> docs/architecture/README.md
        echo '    end' >> docs/architecture/README.md
        echo '' >> docs/architecture/README.md
        echo '    GitHub --> WH' >> docs/architecture/README.md
        echo '    WH --> GP' >> docs/architecture/README.md
        echo '    GP --> DS' >> docs/architecture/README.md
        echo '    DS --> DB' >> docs/architecture/README.md
        echo '    DS --> S3' >> docs/architecture/README.md
        echo '    LLM --> OpenAI' >> docs/architecture/README.md
        echo '    NS --> Slack' >> docs/architecture/README.md
        echo '    NS --> Notion' >> docs/architecture/README.md
        echo '```' >> docs/architecture/README.md
        
        # íŒŒì¼ êµ¬ì¡° ë¶„ì„
        echo "" >> docs/architecture/README.md
        echo "## ğŸ“ Project Structure" >> docs/architecture/README.md
        echo "" >> docs/architecture/README.md
        echo '```' >> docs/architecture/README.md
        tree -I '__pycache__|*.pyc|.git|.venv|node_modules' -L 3 >> docs/architecture/README.md 2>/dev/null || find . -type d -name "__pycache__" -prune -o -type f -print | head -50 >> docs/architecture/README.md
        echo '```' >> docs/architecture/README.md
        
    - name: ğŸ“Š Upload architecture documentation
      uses: actions/upload-artifact@v3
      with:
        name: architecture-documentation
        path: docs/architecture/

  # ğŸ“ ë³€ê²½ ë¡œê·¸ ìë™ ìƒì„±
  changelog-generation:
    name: ğŸ“ Changelog Generation
    runs-on: ubuntu-latest
    if: github.event_name == 'push' && github.ref == 'refs/heads/main' || github.event.inputs.doc_type == 'all' || github.event.inputs.doc_type == 'changelog'
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
        
    - name: ğŸ“ Generate changelog
      run: |
        mkdir -p docs/changelog
        
        echo "# ğŸ“ CodePing.AI Changelog" > docs/changelog/CHANGELOG.md
        echo "" >> docs/changelog/CHANGELOG.md
        echo "All notable changes to this project will be documented in this file." >> docs/changelog/CHANGELOG.md
        echo "" >> docs/changelog/CHANGELOG.md
        echo "The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/)," >> docs/changelog/CHANGELOG.md
        echo "and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html)." >> docs/changelog/CHANGELOG.md
        echo "" >> docs/changelog/CHANGELOG.md
        
        # íƒœê·¸ ê¸°ë°˜ ë³€ê²½ ë¡œê·¸ ìƒì„±
        TAGS=$(git tag --sort=-version:refname | head -10)
        
        if [ -z "$TAGS" ]; then
          echo "## [Unreleased]" >> docs/changelog/CHANGELOG.md
          echo "" >> docs/changelog/CHANGELOG.md
          
          # ì „ì²´ ì»¤ë°‹ íˆìŠ¤í† ë¦¬ë¥¼ ì¹´í…Œê³ ë¦¬ë³„ë¡œ ë¶„ë¥˜
          echo "### ğŸš€ Features" >> docs/changelog/CHANGELOG.md
          git log --oneline --grep="feat:" --pretty=format:"- %s (%h)" >> docs/changelog/CHANGELOG.md
          echo "" >> docs/changelog/CHANGELOG.md
          echo "" >> docs/changelog/CHANGELOG.md
          
          echo "### ğŸ› Bug Fixes" >> docs/changelog/CHANGELOG.md
          git log --oneline --grep="fix:" --pretty=format:"- %s (%h)" >> docs/changelog/CHANGELOG.md
          echo "" >> docs/changelog/CHANGELOG.md
          echo "" >> docs/changelog/CHANGELOG.md
          
          echo "### ğŸ”§ Improvements" >> docs/changelog/CHANGELOG.md
          git log --oneline --grep="refactor:\|perf:\|style:" --pretty=format:"- %s (%h)" >> docs/changelog/CHANGELOG.md
          echo "" >> docs/changelog/CHANGELOG.md
          echo "" >> docs/changelog/CHANGELOG.md
          
          echo "### ğŸ“š Documentation" >> docs/changelog/CHANGELOG.md
          git log --oneline --grep="docs:" --pretty=format:"- %s (%h)" >> docs/changelog/CHANGELOG.md
          echo "" >> docs/changelog/CHANGELOG.md
          
        else
          for tag in $TAGS; do
            echo "## [$tag] - $(git log -1 --format=%ai $tag | cut -d' ' -f1)" >> docs/changelog/CHANGELOG.md
            echo "" >> docs/changelog/CHANGELOG.md
            
            # ì´ì „ íƒœê·¸ì™€ì˜ ì°¨ì´ì  ë¶„ì„
            PREV_TAG=$(git tag --sort=-version:refname | grep -A1 $tag | tail -1)
            if [ "$PREV_TAG" != "$tag" ] && [ -n "$PREV_TAG" ]; then
              RANGE="$PREV_TAG..$tag"
            else
              RANGE="$tag"
            fi
            
            # ì¹´í…Œê³ ë¦¬ë³„ ë³€ê²½ì‚¬í•­
            FEATURES=$(git log $RANGE --oneline --grep="feat:" --pretty=format:"- %s (%h)")
            if [ -n "$FEATURES" ]; then
              echo "### ğŸš€ Features" >> docs/changelog/CHANGELOG.md
              echo "$FEATURES" >> docs/changelog/CHANGELOG.md
              echo "" >> docs/changelog/CHANGELOG.md
            fi
            
            FIXES=$(git log $RANGE --oneline --grep="fix:" --pretty=format:"- %s (%h)")
            if [ -n "$FIXES" ]; then
              echo "### ğŸ› Bug Fixes" >> docs/changelog/CHANGELOG.md
              echo "$FIXES" >> docs/changelog/CHANGELOG.md
              echo "" >> docs/changelog/CHANGELOG.md
            fi
            
            IMPROVEMENTS=$(git log $RANGE --oneline --grep="refactor:\|perf:\|style:" --pretty=format:"- %s (%h)")
            if [ -n "$IMPROVEMENTS" ]; then
              echo "### ğŸ”§ Improvements" >> docs/changelog/CHANGELOG.md
              echo "$IMPROVEMENTS" >> docs/changelog/CHANGELOG.md
              echo "" >> docs/changelog/CHANGELOG.md
            fi
            
            DOCS=$(git log $RANGE --oneline --grep="docs:" --pretty=format:"- %s (%h)")
            if [ -n "$DOCS" ]; then
              echo "### ğŸ“š Documentation" >> docs/changelog/CHANGELOG.md
              echo "$DOCS" >> docs/changelog/CHANGELOG.md
              echo "" >> docs/changelog/CHANGELOG.md
            fi
            
            echo "" >> docs/changelog/CHANGELOG.md
          done
        fi
        
        # ìµœê·¼ ë³€ê²½ì‚¬í•­ ìš”ì•½
        echo "# ğŸ“Š Recent Changes Summary" > docs/changelog/RECENT.md
        echo "" >> docs/changelog/RECENT.md
        echo "Generated on: $(date)" >> docs/changelog/RECENT.md
        echo "" >> docs/changelog/RECENT.md
        
        # ìµœê·¼ 7ì¼ê°„ì˜ ë³€ê²½ì‚¬í•­
        echo "## ğŸ“… Last 7 Days" >> docs/changelog/RECENT.md
        git log --since="7 days ago" --oneline --pretty=format:"- %s (%h) by %an" >> docs/changelog/RECENT.md
        echo "" >> docs/changelog/RECENT.md
        echo "" >> docs/changelog/RECENT.md
        
        # í†µê³„ ì •ë³´
        echo "## ğŸ“Š Statistics" >> docs/changelog/RECENT.md
        echo "- **Total Commits**: $(git rev-list --all --count)" >> docs/changelog/RECENT.md
        echo "- **Contributors**: $(git shortlog -sn | wc -l)" >> docs/changelog/RECENT.md
        echo "- **Branches**: $(git branch -r | wc -l)" >> docs/changelog/RECENT.md
        echo "- **Tags**: $(git tag | wc -l)" >> docs/changelog/RECENT.md
        
    - name: ğŸ“Š Upload changelog
      uses: actions/upload-artifact@v3
      with:
        name: changelog-documentation
        path: docs/changelog/

  # ğŸ“š ë¬¸ì„œ í†µí•© ë° ë°°í¬
  documentation-deployment:
    name: ğŸ“š Documentation Deployment
    runs-on: ubuntu-latest
    needs: [code-analysis, api-documentation, architecture-documentation, changelog-generation]
    if: always() && (needs.code-analysis.result == 'success')
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
      
    - name: ğŸ“¥ Download all documentation artifacts
      uses: actions/download-artifact@v3
      with:
        path: generated-docs/
        
    - name: ğŸ”§ Set up documentation structure
      run: |
        mkdir -p docs-site
        
        # ë©”ì¸ ë¬¸ì„œ ì¸ë±ìŠ¤ ìƒì„±
        cat > docs-site/index.html << 'EOF'
        <!DOCTYPE html>
        <html lang="ko">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>ğŸ“š CodePing.AI Documentation</title>
            <style>
                body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }
                .container { max-width: 1200px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
                h1 { color: #2c3e50; border-bottom: 3px solid #3498db; padding-bottom: 10px; }
                .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 30px; }
                .card { background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #3498db; }
                .card h3 { margin-top: 0; color: #2c3e50; }
                .card a { color: #3498db; text-decoration: none; font-weight: 500; }
                .card a:hover { text-decoration: underline; }
                .badge { background: #e74c3c; color: white; padding: 2px 8px; border-radius: 12px; font-size: 12px; }
                .updated { color: #27ae60; font-size: 14px; }
            </style>
        </head>
        <body>
            <div class="container">
                <h1>ğŸ“š CodePing.AI Documentation Hub</h1>
                <p>ìë™ ìƒì„±ëœ í”„ë¡œì íŠ¸ ë¬¸ì„œë“¤ì„ í•œ ê³³ì—ì„œ í™•ì¸í•˜ì„¸ìš”.</p>
                <p class="updated">ğŸ• ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: $(date)</p>
                
                <div class="grid">
                    <div class="card">
                        <h3>ğŸ”§ API Documentation</h3>
                        <p>ëª¨ë“  ëª¨ë“ˆê³¼ í•¨ìˆ˜ì˜ ìƒì„¸í•œ API ë¬¸ì„œ</p>
                        <a href="api/">API ë¬¸ì„œ ë³´ê¸°</a>
                    </div>
                    
                    <div class="card">
                        <h3>ğŸ—ï¸ Architecture</h3>
                        <p>ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ì™€ ëª¨ë“ˆ ì˜ì¡´ì„± ë‹¤ì´ì–´ê·¸ë¨</p>
                        <a href="architecture/">ì•„í‚¤í…ì²˜ ë¬¸ì„œ ë³´ê¸°</a>
                    </div>
                    
                    <div class="card">
                        <h3>ğŸ“Š Code Metrics</h3>
                        <p>ì½”ë“œ ë³µì¡ë„, í’ˆì§ˆ ì§€í‘œ ë° ë¶„ì„ ë¦¬í¬íŠ¸</p>
                        <a href="metrics/">ë©”íŠ¸ë¦­ ë³´ê¸°</a>
                    </div>
                    
                    <div class="card">
                        <h3>ğŸ“ˆ Test Coverage</h3>
                        <p>í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ ë¦¬í¬íŠ¸ì™€ ìƒì„¸ ë¶„ì„</p>
                        <a href="coverage/">ì»¤ë²„ë¦¬ì§€ ë³´ê¸°</a>
                    </div>
                    
                    <div class="card">
                        <h3>ğŸ“ Changelog</h3>
                        <p>í”„ë¡œì íŠ¸ ë³€ê²½ ì´ë ¥ê³¼ ë¦´ë¦¬ìŠ¤ ë…¸íŠ¸</p>
                        <a href="changelog/">ë³€ê²½ ë¡œê·¸ ë³´ê¸°</a>
                    </div>
                    
                    <div class="card">
                        <h3>ğŸ“‹ Quality Report</h3>
                        <p>ë¬¸ì„œí™” í’ˆì§ˆê³¼ ì½”ë“œ ìŠ¤íƒ€ì¼ ë¦¬í¬íŠ¸</p>
                        <a href="quality/">í’ˆì§ˆ ë¦¬í¬íŠ¸ ë³´ê¸°</a>
                    </div>
                </div>
                
                <hr style="margin: 40px 0;">
                <p style="text-align: center; color: #7f8c8d;">
                    ğŸ¤– ì´ ë¬¸ì„œë“¤ì€ GitHub Actionsë¥¼ í†µí•´ ìë™ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.<br>
                    ğŸ“… ë‹¤ìŒ ì—…ë°ì´íŠ¸: ì½”ë“œ ë³€ê²½ ì‹œ ë˜ëŠ” ë§¤ì£¼ ì¼ìš”ì¼
                </p>
            </div>
        </body>
        </html>
        EOF
        
        # ìƒì„±ëœ ë¬¸ì„œë“¤ì„ docs-siteë¡œ ë³µì‚¬
        if [ -d "generated-docs/code-analysis-reports" ]; then
          cp -r generated-docs/code-analysis-reports/* docs-site/ 2>/dev/null || true
        fi
        
        if [ -d "generated-docs/api-documentation" ]; then
          cp -r generated-docs/api-documentation/* docs-site/ 2>/dev/null || true
        fi
        
        if [ -d "generated-docs/architecture-documentation" ]; then
          cp -r generated-docs/architecture-documentation/* docs-site/ 2>/dev/null || true
        fi
        
        if [ -d "generated-docs/changelog-documentation" ]; then
          cp -r generated-docs/changelog-documentation/* docs-site/ 2>/dev/null || true
        fi
        
    - name: ğŸ“š Deploy to GitHub Pages
      uses: peaceiris/actions-gh-pages@v3
      if: github.ref == 'refs/heads/main'
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./docs-site
        destination_dir: docs
        
    - name: ğŸ“Š Upload complete documentation
      uses: actions/upload-artifact@v3
      with:
        name: complete-documentation-site
        path: docs-site/

  # ğŸ“± ë¬¸ì„œ ì•Œë¦¼
  documentation-notification:
    name: ğŸ“± Documentation Notification
    runs-on: ubuntu-latest
    needs: [documentation-deployment]
    if: always() && needs.documentation-deployment.result == 'success'
    
    steps:
    - name: ğŸ“± Send documentation update notification
      run: |
        echo "ğŸ“š Documentation has been updated!"
        echo "ğŸ”— View documentation at: https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}/docs/"
        echo "ğŸ“Š Updated sections:"
        echo "  - ğŸ”§ API Documentation"
        echo "  - ğŸ—ï¸ Architecture Diagrams" 
        echo "  - ğŸ“Š Code Metrics"
        echo "  - ğŸ“ˆ Test Coverage"
        echo "  - ğŸ“ Changelog"
        echo "  - ğŸ“‹ Quality Reports"
        echo ""
        echo "ğŸ• Last updated: $(date)"
        echo "ğŸ”„ Next update: On code changes or weekly"